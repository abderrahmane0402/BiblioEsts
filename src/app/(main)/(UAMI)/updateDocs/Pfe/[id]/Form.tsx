"use client";
import * as f from "@/components/Form";
import updatePfe from "@/components/server/Pfe/UpdatePfe";
import Button from "@/components/ui/Button";
import * as Toast from "@/components/ui/toast";
import { log } from "console";
import { useRouter } from "next/navigation";
import { useEffect, useRef, useState } from "react";


const Form =  ({ id, children }: { id : string ,children : React.ReactNode }) => {
  const router = useRouter()

  const form = useRef<HTMLFormElement>(null);
  const [open1, setOpen1] = useState(false);
  const [open2, setOpen2] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  
  useEffect(() => {
    if (
      (open1 === true && isLoading === true) ||
      (open2 === true && isLoading === true)
    ) {
      setIsLoading(false);
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [open1, open2]);
  return (
    <f.FormRoot
      onSubmit={() => {
        setIsLoading(true);
      }}
      ref={form}
      className="w-full"
      action={async (FormData) => {
        console.log(FormData);
        const data = await updatePfe(FormData,id);
        console.log("ff");
        
        if (data) {
          setOpen1(true);
          setTimeout(() => setOpen1(false), 1000);
              router.back()

        } else {
          setOpen2(true);
          setTimeout(() => setOpen2(false), 1000);
        }
      }}
    >
      {children}
      <footer className="flex justify-center items-center py-12">
        <f.FormSubmit asChild>
          <Button
            size={"md"}
            isLoading={isLoading}
            className="bg-[#CA3CFF] text-white w-3/12"
          >
            Modifier Pfe
          </Button>
        </f.FormSubmit>
      </footer>

      <Toast.Provider duration={1000}>
        <Toast.Root open={open1} Ttype={"success"}>
          <div>
            <Toast.Title>succès</Toast.Title>
            <Toast.Description>Pfe a été modifier avec succés</Toast.Description>
          </div>
          <Toast.Close asChild onClick={() => setOpen1(false)}>
            <button className="bg-transparent border-2 border-blue-700/50 hover:border-blue-700  focus:border-blue-700 focus:outline-none rounded-md p-2 font-thin text-lg">
              fermer
            </button>
          </Toast.Close>
        </Toast.Root>
        <Toast.Root open={open2} Ttype={"error"}>
          <div>
            <Toast.Title>Error</Toast.Title>
            <Toast.Description>
              verifier les informations inserer
            </Toast.Description>
          </div>
          <Toast.Close asChild onClick={() => setOpen2(false)}>
            <button className="border-2 border-white/50 hover:border-white rounded-md p-2 font-thin text-lg">
              fermer
            </button>
          </Toast.Close>
        </Toast.Root>
        <Toast.ToastViewport className="[--viewport-padding:_25px] fixed bottom-0 right-0 flex flex-col p-[var(--viewport-padding)] gap-[10px] w-[390px] max-w-[100vw] m-0 list-none z-[2147483647] outline-none" />
      </Toast.Provider>
    </f.FormRoot>
  );
};
export default Form